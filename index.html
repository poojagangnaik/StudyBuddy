<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Study Buddy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#111735;
      --muted:#9aa4c7;
      --text:#e7ecff;
      --accent:#6c9dff;
      --accent-2:#9b7bff;
      --ok:#3ddc97;
      --warn:#ffb648;
      --danger:#ff6b6b;
      --ring: 0 0 0 2px rgba(108,157,255,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 120% -20%, rgba(108,157,255,.07), transparent 60%),
                  radial-gradient(1000px 700px at -20% 120%, rgba(155,123,255,.07), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .container{
      max-width:1200px;
      margin:0 auto;
      padding:24px;
    }
    header{
      display:flex;align-items:center;gap:16px;justify-content:space-between;margin-bottom:18px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:40px;height:40px;border-radius:12px;
      background: linear-gradient(135deg,var(--accent),var(--accent-2));
      box-shadow:0 10px 30px rgba(108,157,255,.35), inset 0 0 20px rgba(255,255,255,.12);
      position:relative;
    }
    .logo:after{content:"";position:absolute;inset:8px;border-radius:8px;background:rgba(255,255,255,.15)}
    h1{font-size:1.4rem;margin:0;font-weight:600;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:.9rem}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{
      appearance:none;border:none;background:var(--panel);color:var(--text);
      padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600
    }
    .btn:hover{filter:brightness(1.06)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2))}
    .btn.icon{padding:10px;width:42px;display:grid;place-items:center}

    .grid{
      display:grid;gap:16px;
      grid-template-columns: 1.2fr 1fr;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px;
      padding:16px;
      backdrop-filter: blur(8px);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    .card h2{margin:.2rem 0 0.6rem;font-size:1.05rem}

    /* Pomodoro */
    .timer{
      display:grid;grid-template-columns: 180px 1fr;gap:16px;align-items:center;
    }
    @media (max-width:700px){.timer{grid-template-columns:1fr}}

    .dial{
      width:180px;height:180px;border-radius:24px;display:grid;place-items:center;
      background:radial-gradient(circle at 30% 30%, rgba(108,157,255,.2), transparent 40%),
                 linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      position:relative;overflow:hidden
    }
    .time{
      font-size:2.2rem;font-weight:700;letter-spacing:1px
    }
    .phase{font-size:.9rem;color:var(--muted);margin-top:-6px}
    .ring{position:absolute;inset:0;}

    .timer-controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    label{font-size:.85rem;color:var(--muted)}
    input[type="number"], select, input[type="text"]{
      background:rgba(255,255,255,.06);color:var(--text);
      border:1px solid rgba(255,255,255,.12);padding:8px 10px;border-radius:10px;
      outline:none;
    }
    input[type="number"]:focus, select:focus, input[type="text"]:focus{box-shadow:var(--ring)}

    /* Todo */
    .todo{
      display:flex;gap:12px;align-items:center;margin:10px 0
    }
    .todo input[type="text"]{flex:1}
    .task-list{display:flex;flex-direction:column;gap:8px;margin-top:8px;max-height:300px;overflow:auto}
    .task{
      display:flex;align-items:center;gap:10px;justify-content:space-between;
      padding:10px;border-radius:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08)
    }
    .task-left{display:flex;gap:10px;align-items:center}
    .task-title{font-weight:500}
    .task-sub{font-size:.8rem;color:var(--muted)}
    .chip{font-size:.7rem;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1)}

    /* Subjects */
    .subjects{display:flex;flex-direction:column;gap:10px}
    .subject{
      display:grid;grid-template-columns: 1fr auto;gap:8px;align-items:center;
      padding:12px;border-radius:14px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);
    }
    .subject .meta{display:flex;align-items:center;gap:8px}

    /* Footer */
    footer{margin-top:16px;color:var(--muted);font-size:.85rem;display:flex;gap:8px;align-items:center;justify-content:space-between}

    .hidden{display:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Study Buddy</h1>
          <div class="sub">Pomodoro â€¢ Tasks â€¢ Subject Tracking â€¢ Progress</div>
        </div>
      </div>
      <div class="controls">
        <button id="exportBtn" class="btn">Export Data</button>
        <button id="importBtn" class="btn">Import Data</button>
        <input id="importFile" type="file" accept="application/json" class="hidden" />
      </div>
    </header>

    <div class="grid">
      <!-- Left column: Timer + Tasks -->
      <section class="card">
        <h2>Pomodoro</h2>
        <div class="timer">
          <div class="dial">
            <canvas id="progressRing" class="ring" width="180" height="180" aria-hidden="true"></canvas>
            <div>
              <div class="time" id="timeDisplay">25:00</div>
              <div class="phase" id="phaseDisplay">Focus</div>
            </div>
          </div>
          <div>
            <div class="row">
              <label>Mode</label>
              <select id="phaseSelect">
                <option value="focus">Focus</option>
                <option value="short">Short Break</option>
                <option value="long">Long Break</option>
              </select>
              <label>Subject</label>
              <select id="subjectSelect"></select>
              <button class="btn" id="newSubjectQuick">+ Subject</button>
            </div>
            <div class="row" style="margin-top:8px">
              <label>Focus (min)</label>
              <input type="number" id="focusInput" min="1" max="180" value="25">
              <label>Short (min)</label>
              <input type="number" id="shortInput" min="1" max="60" value="5">
              <label>Long (min)</label>
              <input type="number" id="longInput" min="1" max="60" value="15">
              <label>Long every</label>
              <input type="number" id="cycleInput" min="1" max="12" value="4">
            </div>
            <div class="timer-controls">
              <button class="btn primary" id="startBtn">Start</button>
              <button class="btn" id="pauseBtn">Pause</button>
              <button class="btn" id="resetBtn">Reset</button>
              <span class="chip" id="sessionChip" title="Completed focus sessions today">0 sessions</span>
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Toâ€‘Do</h2>
        <div class="todo">
          <input id="taskTitle" type="text" placeholder="Add a taskâ€¦" />
          <select id="taskSubject"></select>
          <button class="btn" id="addTaskBtn">Add</button>
        </div>
        <div class="task-list" id="taskList"></div>
      </section>

      <!-- Right column: Subjects + Progress -->
      <section class="card">
        <h2>Subjects</h2>
        <div class="row" style="margin-bottom:8px">
          <input id="subjectName" type="text" placeholder="New subject name" />
          <button class="btn" id="addSubjectBtn">Add Subject</button>
        </div>
        <div class="subjects" id="subjects"></div>
      </section>

      <section class="card">
        <h2>Progress</h2>
        <div class="row" style="margin-bottom:6px">
          <span class="chip">Today: <span id="todayMinutes">0</span> min</span>
          <span class="chip">This Week: <span id="weekMinutes">0</span> min</span>
        </div>
        <canvas id="progressChart" height="200" aria-label="Weekly study minutes chart"></canvas>
        <canvas id="subjectChart" height="220" style="margin-top:12px" aria-label="Subject distribution chart"></canvas>
      </section>
    </div>

    <footer>
      <div>Auto-saves to your browser. Export/Import to move devices.</div>
      <div>Made with ðŸ’™ for focused learners.</div>
    </footer>
  </div>

  <script>
  // ========= Utilities & Storage =========
  const storageKey = 'studyBuddy.v1';
  const $ = (sel)=>document.querySelector(sel);
  const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
  const todayKey = ()=> new Date().toISOString().slice(0,10);

  const defaultState = {
    settings:{focus:25, short:5, long:15, longEvery:4},
    timer:{phase:'focus', remaining:25*60, running:false, cycleCount:0, sessionsToday:{}},
    subjects:[{id: uid(), name:'General', minutes:0}],
    tasks:[],
    stats:{days:{}, weekCache:{}},
    lastOpen: todayKey()
  };

  function uid(){return Math.random().toString(36).slice(2,9)}

  function load(){
    const raw = localStorage.getItem(storageKey);
    if(!raw){
      save(defaultState);
      return structuredClone(defaultState);
    }
    try{
      const state = JSON.parse(raw);
      // Migration safety
      if(!state.subjects?.length){state.subjects=[{id:uid(), name:'General', minutes:0}]}
      return state;
    }catch(e){
      console.warn('Resetting corrupted storage');
      save(defaultState);
      return structuredClone(defaultState);
    }
  }
  function save(state){ localStorage.setItem(storageKey, JSON.stringify(state)); }

  let state = load();

  // Reset daily sessions counter if day changed
  if(state.lastOpen !== todayKey()){
    state.timer.sessionsToday = {};
    state.lastOpen = todayKey();
    save(state);
  }

  // ========= Elements =========
  const timeDisplay = $('#timeDisplay');
  const phaseDisplay = $('#phaseDisplay');
  const progressRing = $('#progressRing');
  const startBtn = $('#startBtn');
  const pauseBtn = $('#pauseBtn');
  const resetBtn = $('#resetBtn');
  const phaseSelect = $('#phaseSelect');
  const subjectSelect = $('#subjectSelect');
  const newSubjectQuick = $('#newSubjectQuick');

  const focusInput = $('#focusInput');
  const shortInput = $('#shortInput');
  const longInput = $('#longInput');
  const cycleInput = $('#cycleInput');
  const sessionChip = $('#sessionChip');

  const taskTitle = $('#taskTitle');
  const taskSubject = $('#taskSubject');
  const addTaskBtn = $('#addTaskBtn');
  const taskList = $('#taskList');

  const subjectName = $('#subjectName');
  const addSubjectBtn = $('#addSubjectBtn');
  const subjectsEl = $('#subjects');

  const todayMinutesEl = $('#todayMinutes');
  const weekMinutesEl = $('#weekMinutes');

  const exportBtn = $('#exportBtn');
  const importBtn = $('#importBtn');
  const importFile = $('#importFile');

  // ========= Render Helpers =========
  function formatTime(sec){
    const m = Math.floor(sec/60); const s = sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  function renderTimer(){
    timeDisplay.textContent = formatTime(state.timer.remaining);
    phaseDisplay.textContent =
      state.timer.phase==='focus'? 'Focus' : state.timer.phase==='short'? 'Short Break' : 'Long Break';

    focusInput.value = state.settings.focus;
    shortInput.value = state.settings.short;
    longInput.value = state.settings.long;
    cycleInput.value = state.settings.longEvery;
    phaseSelect.value = state.timer.phase;

    // Sessions today
    const totalSessions = Object.values(state.timer.sessionsToday).reduce((a,b)=>a+b,0);
    sessionChip.textContent = `${totalSessions} session${totalSessions!==1?'s':''}`;

    drawRing();
  }

  function drawRing(){
    const ctx = progressRing.getContext('2d');
    const w = progressRing.width, h = progressRing.height; const r = Math.min(w,h)/2 - 10; const cx=w/2, cy=h/2;
    ctx.clearRect(0,0,w,h);
    // Background track
    ctx.globalAlpha = 0.25; ctx.lineWidth = 14; ctx.strokeStyle = '#6c9dff';
    ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke();
    // Progress
    const total = (state.timer.phase==='focus'? state.settings.focus : state.timer.phase==='short'? state.settings.short : state.settings.long) * 60;
    const frac = 1 - (state.timer.remaining/Math.max(1,total));
    ctx.globalAlpha = 1; ctx.lineWidth = 14; ctx.lineCap = 'round';
    const grad = ctx.createLinearGradient(0,0,w,h); grad.addColorStop(0,'#6c9dff'); grad.addColorStop(1,'#9b7bff');
    ctx.strokeStyle = grad;
    ctx.beginPath(); ctx.arc(cx,cy,r, -Math.PI/2, -Math.PI/2 + Math.PI*2*frac);
    ctx.stroke();
  }

  function renderSubjects(){
    // Populate dropdowns
    subjectSelect.innerHTML = '';
    taskSubject.innerHTML = '';
    state.subjects.forEach(s=>{
      const o = document.createElement('option'); o.value=s.id; o.textContent=s.name; subjectSelect.appendChild(o);
      const o2 = document.createElement('option'); o2.value=s.id; o2.textContent=s.name; taskSubject.appendChild(o2);
    });

    subjectsEl.innerHTML = '';
    state.subjects.forEach(sub=>{
      const el = document.createElement('div'); el.className='subject';
      el.innerHTML = `
        <div>
          <div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
            <div class="meta"><span class="task-title">${sub.name}</span><span class="chip">${sub.minutes||0} min</span></div>
            <div>
              <button class="btn icon" title="Add 5 min" data-add5="${sub.id}">+5</button>
              <button class="btn icon" title="Rename" data-rename="${sub.id}">âœŽ</button>
              <button class="btn icon" title="Delete" data-del="${sub.id}">ðŸ—‘</button>
            </div>
          </div>
        </div>`;
      subjectsEl.appendChild(el);
    });
  }

  function renderTasks(){
    taskList.innerHTML = '';
    state.tasks.sort((a,b)=> Number(a.done)-Number(b.done) || a.created - b.created);
    state.tasks.forEach(task=>{
      const sub = state.subjects.find(s=>s.id===task.subjectId);
      const el = document.createElement('div'); el.className='task';
      el.innerHTML = `
        <div class="task-left">
          <input type="checkbox" ${task.done?'checked':''} data-toggle="${task.id}">
          <div>
            <div class="task-title">${task.title}</div>
            <div class="task-sub">${sub?sub.name:'â€”'}</div>
          </div>
        </div>
        <div class="row">
          <button class="btn icon" title="Edit" data-edit="${task.id}">âœŽ</button>
          <button class="btn icon" title="Delete" data-del="${task.id}">ðŸ—‘</button>
        </div>`;
      taskList.appendChild(el);
    })
  }

  // ========= Timer Logic =========
  let tickHandle = null;
  function setPhase(phase){
    state.timer.phase = phase;
    const mins = phase==='focus'? state.settings.focus : phase==='short'? state.settings.short : state.settings.long;
    state.timer.remaining = Math.round(mins*60);
    save(state); renderTimer();
  }

  function startTimer(){
    if(state.timer.running) return;
    state.timer.running = true; save(state);
    const last = Date.now();
    let prev = last;
    tickHandle = setInterval(()=>{
      const now = Date.now();
      const elapsed = Math.floor((now - prev)/1000);
      if(elapsed>0){
        state.timer.remaining = Math.max(0, state.timer.remaining - elapsed);
        prev = now; renderTimer();
        if(state.timer.remaining===0){
          completePhase();
        }
      }
    }, 250);
  }

  function pauseTimer(){
    state.timer.running = false; save(state);
    if(tickHandle){ clearInterval(tickHandle); tickHandle=null; }
  }

  function resetTimer(){
    pauseTimer();
    setPhase(state.timer.phase);
  }

  function completePhase(){
    pauseTimer();
    if(state.timer.phase==='focus'){
      // credit minutes to subject
      const subId = subjectSelect.value || state.subjects[0]?.id;
      const mins = state.settings.focus;
      addStudyMinutes(subId, mins);

      // increment session count for today and maybe trigger long break
      state.timer.sessionsToday[subId] = (state.timer.sessionsToday[subId]||0) + 1;
      state.timer.cycleCount = (state.timer.cycleCount||0)+1;
      const isLong = (state.timer.cycleCount % state.settings.longEvery)===0;
      setPhase(isLong? 'long' : 'short');
    } else {
      setPhase('focus');
    }
    save(state);
  }

  function addStudyMinutes(subjectId, mins){
    const sub = state.subjects.find(s=>s.id===subjectId);
    if(sub){ sub.minutes = (sub.minutes||0) + mins; }

    // Stats per day
    const day = todayKey();
    state.stats.days[day] = (state.stats.days[day]||0) + mins;

    // Weekly cache (roll 7 days)
    pruneOldDays();
    save(state);
    renderSubjects();
    updateCharts();
    updateSummaryBadges();
  }

  function pruneOldDays(){
    const keys = Object.keys(state.stats.days).sort();
    // Keep last 28 days only
    const cut = Math.max(0, keys.length - 28);
    for(let i=0;i<cut;i++) delete state.stats.days[keys[i]];
  }

  // ========= Tasks =========
  function addTask(title, subjectId){
    if(!title.trim()) return;
    state.tasks.push({id:uid(), title:title.trim(), subjectId, done:false, created:Date.now()});
    save(state); renderTasks();
  }
  function toggleTask(id){
    const t = state.tasks.find(x=>x.id===id); if(!t) return; t.done=!t.done; save(state); renderTasks();
  }
  function editTask(id){
    const t = state.tasks.find(x=>x.id===id); if(!t) return; const nt = prompt('Edit task', t.title); if(nt!==null){ t.title = nt.trim(); save(state); renderTasks(); }
  }
  function deleteTask(id){
    state.tasks = state.tasks.filter(x=>x.id!==id); save(state); renderTasks();
  }

  // ========= Subjects =========
  function addSubject(name){
    const clean = name.trim(); if(!clean) return;
    state.subjects.push({id:uid(), name:clean, minutes:0}); save(state); renderSubjects(); updateCharts();
  }
  function renameSubject(id){
    const s = state.subjects.find(x=>x.id===id); if(!s) return; const nn = prompt('Rename subject', s.name); if(nn!==null){ s.name = nn.trim(); save(state); renderSubjects(); updateCharts(); }
  }
  function deleteSubject(id){
    if(state.subjects.length<=1){ return alert('Keep at least one subject.'); }
    // Reassign tasks of this subject to first subject
    const first = state.subjects.find(s=>s.id!==id) || state.subjects[0];
    state.tasks.forEach(t=>{ if(t.subjectId===id) t.subjectId = first.id; })
    state.subjects = state.subjects.filter(s=>s.id!==id); save(state); renderSubjects(); renderTasks(); updateCharts();
  }

  // ========= Charts =========
  let progressChart, subjectChart;
  function getLast7(){
    // return labels + values for last 7 days including today
    const days = [];
    for(let i=6;i>=0;i--){
      const d = new Date(); d.setDate(d.getDate()-i);
      const k = d.toISOString().slice(0,10);
      days.push({label: d.toLocaleDateString(undefined,{weekday:'short'}), key:k, val: state.stats.days[k]||0});
    }
    return days;
  }
  function updateSummaryBadges(){
    const today = todayKey();
    const week = getLast7().reduce((a,x)=>a+x.val,0);
    todayMinutesEl.textContent = state.stats.days[today]||0;
    weekMinutesEl.textContent = week;
  }

  function updateCharts(){
    const ctx = document.getElementById('progressChart');
    const sctx = document.getElementById('subjectChart');

    const weekData = getLast7();
    const labels = weekData.map(x=>x.label);
    const values = weekData.map(x=>x.val);

    if(progressChart) progressChart.destroy();
    progressChart = new Chart(ctx, {
      type: 'bar',
      data: { labels, datasets: [{ label: 'Minutes', data: values }] },
      options: {
        responsive:true,
        plugins:{ legend:{display:false} },
        scales:{ y:{ beginAtZero:true } }
      }
    });

    if(subjectChart) subjectChart.destroy();
    const subLabels = state.subjects.map(s=>s.name);
    const subVals = state.subjects.map(s=>s.minutes||0);
    subjectChart = new Chart(sctx, {
      type:'doughnut',
      data:{ labels: subLabels, datasets:[{ data: subVals }] },
      options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
    });
  }

  // ========= Import/Export =========
  exportBtn.addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download = `study-buddy-${todayKey()}.json`; a.click();
    setTimeout(()=>URL.revokeObjectURL(url), 1000);
  });
  importBtn.addEventListener('click', ()=> importFile.click());
  importFile.addEventListener('change', async (e)=>{
    const file = e.target.files[0]; if(!file) return;
    try{
      const text = await file.text();
      const incoming = JSON.parse(text);
      // minimal validation
      if(!incoming.settings || !incoming.subjects || !incoming.tasks) throw new Error('Invalid file');
      state = incoming; save(state);
      boot();
      alert('Data imported!');
    }catch(err){
      alert('Import failed: '+ err.message);
    } finally { importFile.value = ''; }
  });

  // ========= Wire Up UI =========
  startBtn.addEventListener('click', startTimer);
  pauseBtn.addEventListener('click', pauseTimer);
  resetBtn.addEventListener('click', resetTimer);

  phaseSelect.addEventListener('change', e=> setPhase(e.target.value));
  [focusInput, shortInput, longInput, cycleInput].forEach(input=>{
    input.addEventListener('change', ()=>{
      state.settings.focus = Number(focusInput.value)||25;
      state.settings.short = Number(shortInput.value)||5;
      state.settings.long = Number(longInput.value)||15;
      state.settings.longEvery = Math.max(1, Number(cycleInput.value)||4);
      // If not running, refresh current phase remaining to new duration
      if(!state.timer.running) setPhase(state.timer.phase);
      save(state);
    })
  });

  newSubjectQuick.addEventListener('click',()=>{
    const name = prompt('New subject name'); if(name) addSubject(name);
  })

  addTaskBtn.addEventListener('click', ()=>{
    addTask(taskTitle.value, taskSubject.value||state.subjects[0]?.id);
    taskTitle.value=''; taskTitle.focus();
  })
  taskTitle.addEventListener('keydown', e=>{ if(e.key==='Enter'){ addTaskBtn.click(); }});

  taskList.addEventListener('click', (e)=>{
    const t = e.target;
    if(t.matches('input[type="checkbox"][data-toggle]')) toggleTask(t.getAttribute('data-toggle'));
    if(t.closest('[data-edit]')) editTask(t.closest('[data-edit]').getAttribute('data-edit'));
    if(t.closest('[data-del]')) deleteTask(t.closest('[data-del]').getAttribute('data-del'));
  })

  addSubjectBtn.addEventListener('click', ()=>{
    addSubject(subjectName.value); subjectName.value=''; subjectName.focus();
  })
  subjectsEl.addEventListener('click', (e)=>{
    const btn = e.target.closest('button'); if(!btn) return;
    if(btn.hasAttribute('data-add5')) addStudyMinutes(btn.getAttribute('data-add5'), 5);
    if(btn.hasAttribute('data-rename')) renameSubject(btn.getAttribute('data-rename'));
    if(btn.hasAttribute('data-del')) deleteSubject(btn.getAttribute('data-del'));
  })

  // ========= Boot =========
  function boot(){
    renderTimer(); renderSubjects(); renderTasks(); updateSummaryBadges(); updateCharts();
    // Ensure some subject is selected in timer
    subjectSelect.value = subjectSelect.value || state.subjects[0]?.id;
  }
  // Initialize timer remaining on first load
  if(!state.timer.remaining){ state.timer.remaining = (state.settings.focus||25)*60; }
  boot();
  </script>
</body>
</html>


